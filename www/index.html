<html>
  <head>
      <title>Title</title>
      <link rel="stylesheet" href="style.css"/>
  </head>
  <body>
    <div class="container">
      <div id="help">
        <div class="full">
          <div class="bigtitle">The Transit Delays Dashboard</div>
          <div class="close_button">Ã—</div>
        </div>
        <div class="half">
          <p>
           Transit systems measure quality of service in different ways. 
           Headways vs on-time performance.
           On-time performance is subject to arbitrary accounting methods
           Headway is more important than OTP.
           http://www.sfgate.com/bayarea/article/In-S-F-Muni-slows-crime-grows-5132822.php
            
          </p>
        </div><div class="half right">
          <div>
            <svg width="70" height="50" class="tutorial">
              <line x1="-10" y1="50" x2="30" y2="0" class="guide"/>
              <line x1="10" y1="50" x2="50" y2="0" class="guide"/>
              <line x1="30" y1="50" x2="70" y2="0" class="guide"/>
              <line x1="50" y1="50" x2="90" y2="0" class="guide"/>
              <path d="M 10 50 L 20 35 L 35 32 L 40 30 L 50 20" class="vehiclePath"/>
              <polygon points="0,3 6,0 0,-3" transform="translate(50,20) rotate(-45)"/>
            </svg>
            <p><span class="emph">Delays:</span> Vehicles become behind schedule due to street traffic.</p>
          </div>
          <div>
            <svg width="70" height="50" class="tutorial">
              <line x1="-10" y1="50" x2="30" y2="0" class="guide"/>
              <line x1="10" y1="50" x2="50" y2="0" class="guide"/>
              <line x1="30" y1="50" x2="70" y2="0" class="guide"/>
              <line x1="50" y1="50" x2="90" y2="0" class="guide"/>
              <path d="M 10 50 L 20 35 L 35 35 L 55 30 L 60 25" class="vehiclePath"/>
              <polygon points="0,3 6,0 0,-3" transform="translate(60,25) rotate(-45)"/>
              <path d="M 30 50 L 40 35 L 55 32 L 60 30" class="vehiclePath"/>
              <polygon points="0,3 6,0 0,-3" transform="translate(60,30) rotate(-45)"/>
            </svg>
            <p><span class="emph">Bunching:</span> Late vehicles get later as they need to pick up more passengers.</p>
          </div>
          <div>
            <svg width="70" height="50" class="tutorial">
              <line x1="-10" y1="50" x2="30" y2="0" class="guide"/>
              <line x1="10" y1="50" x2="50" y2="0" class="guide"/>
              <line x1="30" y1="50" x2="70" y2="0" class="guide"/>
              <line x1="50" y1="50" x2="90" y2="0" class="guide"/>
              <path d="M 13 50 L 53 0" class="vehiclePath"/>
              <path d="M 53 50 L 60 41" class="vehiclePath"/>
              <polygon points="0,3 6,0 0,-3" transform="translate(60,41) rotate(-45)"/>
            </svg>
            <p><span class="emph">Infrequent Service:</span> Service is smooth but inconsistent.</p>
          </div>
        </div>
      </div>
      <div id="agencylist">
        <div class="agency selected">
          <div class="agency_header">SFMTA</div>
          San Francisco, USA
        </div>
        <div class="agency">
          <div class="agency_header">WMATA</div>
          Washington DC, USA
        </div>
        <div class="agency">
          <div class="agency_header">MBTA</div>
          Boston, USA
        </div>
      </div>
      <div id="datepicker">
      </div>
      <div id="chooser">
      </div>
      <div id="chartlist">
      </div>
      <div id="credits">
        <h1>Credits</h1>
        <p>Data via GTFS. San Francisco MTA. NextBus.http://sfmta.com/about-sfmta/reports/gtfs-transit-data </p> 
        <p>Design derived from original train schedule by E.J. Marey.</p>
        <p>For inquiries, contact bdon@bdon.org</p>
      </div>
    </div>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="src/index.js"/></script>
    <script>
      var p = Transit.Page("http://transit.bdon.org/static", "http://transit.bdon.org");

      d3.json(p.static_endpoint() + "/routes.json",function(data) {
        p.setCalendar(data.calendar);
        d3.select("#chooser").selectAll(".rollsign").data(data.routes).enter()
          .append("div").attr("class","rollsign").text(function(d) { return d.short_name })
          .on("click", function(d) {
            var displayed = d3.select(this).classed("displayed");
            displayed ? p.removeRoute(d) : p.showRoute(d);
            p.draw();
            d3.select(this).classed("displayed",!displayed); 
          });

          var preselect = function(short_name) {
            p.showRoute(data.routes.filter(function(d) { return d.short_name == short_name })[0]);
            d3.selectAll(".rollsign").filter(function(d) { return d.short_name == short_name }).classed("displayed", true);
            p.draw();
          }

          preselect("N");
          preselect("71");
          preselect("1");
      });

      setInterval(function() {
        console.log("Global update");
        p.update();
      }, 10 * 1000);
    </script>
  </body>
</html>

