<html>
  <head>
      <title>Title</title>
      <link rel="stylesheet" href="style.css"/>
  </head>
  <body>
    <div class="container">
      <div id="help">
        <div class="full">
          <div class="bigtitle">Title TK</div>
          <div class="close_button">Ã—</div>
        </div>
        <div class="half">
          <p>
           Transit systems measure quality of service in different ways. 
           Headways vs on-time performance.
           On-time performance is subject to arbitrary accounting methods
           Headway is more important than OTP.
           http://www.sfgate.com/bayarea/article/In-S-F-Muni-slows-crime-grows-5132822.php
            
          </p>
        </div><div class="half right">
          <div>
            <svg width="70" height="50" class="tutorial"></svg>
            <p><span class="emph">Delays:</span> Vehicles become behind schedule due to street traffic.</p>
          </div>
          <div>
            <svg width="70" height="50" class="tutorial"></svg>
            <p><span class="emph">Bunching:</span> Late vehicles get later as they need to pick up more passengers.</p>
          </div>
          <div>
            <svg width="70" height="50" class="tutorial"></svg>
            <p><span class="emph">Infrequent Service:</span> Service is smooth but inconsistent.</p>
          </div>
        </div>
      </div>
      <div id="agencylist">
        <div class="agency selected">
          <div class="agency_header">SFMTA</div>
          San Francisco, USA
        </div>
        <div class="agency">
          <div class="agency_header">WMATA</div>
          Washington DC, USA
        </div>
        <div class="agency">
          <div class="agency_header">MBTA</div>
          Boston, USA
        </div>
      </div>
      <div id="datepicker">
      </div>
      <div id="chooser">
      </div>
      <div id="chartlist">
      </div>
      <div id="credits">
        <h1>Credits</h1>
        <p>Data via GTFS. San Francisco MTA. NextBus.</p>
        <p>Design derived from original train schedule by E.J. Marey.</p>
        <p>For inquiries, contact bdon@bdon.org</p>
      </div>
    </div>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="src/index.js"/></script>
    <script>
      var p = Transit.Page("http://localhost:8081/static", "http://localhost:8080");
      //var p = Transit.Page("http://162.243.156.169/static", "http://162.243.156.169");

      function draw() {
        console.log(p.routes());
        var cl = d3.select("#chartlist").selectAll(".route").data(p.routes(), function(d) { return d.id });
        var enters = cl.enter().append("div").attr("class","route");
        enters.call(timelineChart(p));
        cl.order();
        cl.exit().remove();
      }

      d3.json(p.static_endpoint() + "/routes.json",function(data) {
        d3.select("#chooser").selectAll(".rollsign").data(data).enter()
          .append("div").attr("class","rollsign").text(function(d) { return d.short_name })
          .on("click", function(d) {
            var displayed = d3.select(this).classed("displayed");
            displayed ? p.removeRoute(d) : p.showRoute(d);
            draw();
            d3.select(this).classed("displayed",!displayed); 
          });

          // pre-select some routes
          p.showRoute(data.filter(function(d) { return d.id == "1093" })[0]);
          d3.selectAll(".rollsign").filter(function(d) { return d.id == "1093" }).classed("displayed", true);
          draw();
          p.showRoute(data.filter(function(d) { return d.id == "1071" })[0]);
          d3.selectAll(".rollsign").filter(function(d) { return d.id == "1071" }).classed("displayed", true);
          draw();
          p.showRoute(data.filter(function(d) { return d.id == "8701" })[0]);
          d3.selectAll(".rollsign").filter(function(d) { return d.id == "8701" }).classed("displayed", true);
          draw();
      });

      setInterval(function() {
        console.log("Global update");
        p.update();
      }, 10 * 1000);
    </script>
  </body>
</html>

