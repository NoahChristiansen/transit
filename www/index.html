<html>
  <head>
      <title>Title</title>
      <link rel="stylesheet" href="style.css"/>
  </head>
  <body>
    <div class="container">
      <h3>Agency: SFMTA</h3>
      <div id="chooser">
      </div>
      <div id="chartlist">
      </div>
    </div>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="src/index.js"/></script>
    <script>
      var p = Transit.Page("http://localhost:8080/static", "http://162.243.156.169");

      function draw() {
        var cl = d3.select("#chartlist").selectAll(".route").data(p.routes(), function(d) { return d.id });
        var enters = cl.enter().append("div").attr("class","route");
        enters.call(timelineChart(p));
        cl.exit().remove();
      }

      d3.json(p.static_endpoint() + "/routes.json",function(data) {
        d3.select("#chooser").selectAll(".rollsign").data(data).enter()
          .append("div").attr("class","rollsign").text(function(d) { return d.short_name })
          .on("click", function(d) {
            var displayed = d3.select(this).classed("displayed");
            displayed ? p.removeRoute(d) : p.showRoute(d);
            draw();
            d3.select(this).classed("displayed",!displayed); 
          });

          // pre-select some routes
          p.showRoute(data.filter(function(d) { return d.id == "1093" })[0]);
          d3.selectAll(".rollsign").filter(function(d) { return d.id == "1093" }).classed("displayed", true);
          draw();
          p.showRoute(data.filter(function(d) { return d.id == "1071" })[0]);
          d3.selectAll(".rollsign").filter(function(d) { return d.id == "1071" }).classed("displayed", true);
          draw();
      });

      setInterval(function() {
        console.log("Global update");
        p.update();
      }, 10 * 1000);
    </script>
  </body>
</html>

